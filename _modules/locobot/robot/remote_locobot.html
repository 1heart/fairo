

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>locobot.robot.remote_locobot &mdash; droidlet master documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> droidlet
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../controller.html">Controller</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../controller.html#dialogue-stack-and-manager">Dialogue Stack and Manager</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../controller.html#semantic-parser">Semantic Parser</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../controller.html#dialogue-objects">Dialogue Objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../controller.html#interpreter">Interpreter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory.html">Memory</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../memory.html#database">Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../memory.html#memorynodes">MemoryNodes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../perception.html">Perception</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../droidlet_agents.html">Agents</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../droidlet_agents.html#locobot">Locobot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../droidlet_agents.html#locobot-perception">Locobot Perception</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../droidlet_agents.html#locobot-pyrobot-interface">Locobot PyRobot interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../droidlet_agents.html#craftassist">Craftassist</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../droidlet_agents.html#craftassist-perception">Craftassist Perception</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">droidlet</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>locobot.robot.remote_locobot</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for locobot.robot.remote_locobot</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Copyright (c) Facebook, Inc. and its affiliates.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># python -m Pyro4.naming -n &lt;MYIP&gt;</span>

<span class="kn">import</span> <span class="nn">Pyro4</span>
<span class="kn">from</span> <span class="nn">pyrobot</span> <span class="kn">import</span> <span class="n">Robot</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.transform</span> <span class="kn">import</span> <span class="n">Rotation</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">skfmm</span>
<span class="kn">import</span> <span class="nn">skimage</span>
<span class="kn">from</span> <span class="nn">pyrobot.locobot.camera</span> <span class="kn">import</span> <span class="n">DepthImgProcessor</span>
<span class="kn">from</span> <span class="nn">slam.slam</span> <span class="kn">import</span> <span class="n">Slam</span>

<span class="n">Pyro4</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">SERIALIZERS_ACCEPTED</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;pickle&quot;</span><span class="p">)</span>
<span class="n">Pyro4</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ITER_STREAMING</span> <span class="o">=</span> <span class="kc">True</span>


<div class="viewcode-block" id="RemoteLocobot"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot">[docs]</a><span class="nd">@Pyro4</span><span class="o">.</span><span class="n">expose</span>
<span class="k">class</span> <span class="nc">RemoteLocobot</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;PyRobot interface for the Locobot.</span>

<span class="sd">    Args:</span>
<span class="sd">        backend (string): the backend for the Locobot (&quot;habitat&quot; for the locobot in Habitat, and &quot;locobot&quot; for the physical LocoBot)</span>
<span class="sd">        (default: locobot)</span>
<span class="sd">        backend_config (dict): the backend config used for connecting to Habitat (default: None)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;locobot&quot;</span><span class="p">,</span> <span class="n">backend_config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;locobot&quot;</span><span class="p">:</span>
            <span class="n">base_config_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;base_controller&quot;</span><span class="p">:</span> <span class="s2">&quot;proportional&quot;</span><span class="p">}</span>
            <span class="n">arm_config_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">moveit_planner</span><span class="o">=</span><span class="s2">&quot;ESTkConfigDefault&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span> <span class="o">=</span> <span class="n">Robot</span><span class="p">(</span>
                <span class="n">backend</span><span class="p">,</span>
                <span class="n">use_base</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">use_arm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">use_camera</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">base_config</span><span class="o">=</span><span class="n">base_config_dict</span><span class="p">,</span>
                <span class="n">arm_config</span><span class="o">=</span><span class="n">arm_config_dict</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_dip</span> <span class="o">=</span> <span class="n">DepthImgProcessor</span><span class="p">()</span>

            <span class="kn">from</span> <span class="nn">grasp_samplers.grasp</span> <span class="kn">import</span> <span class="n">Grasper</span>

        <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;habitat&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">backend_config</span><span class="p">[</span><span class="s2">&quot;physics_config&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DEFAULT&quot;</span><span class="p">:</span>
                <span class="n">assets_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;../test/test_assets&quot;</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">backend_config</span><span class="p">[</span><span class="s2">&quot;physics_config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">assets_path</span><span class="p">,</span> <span class="s2">&quot;default.phys_scene_config.json&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backend_config</span> <span class="o">=</span> <span class="n">backend_config</span>
            <span class="c1"># we do it this way to have the ability to restart from the client at arbitrary times</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_habitat</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unknown backend&quot;</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>

        <span class="c1"># check skfmm, skimage in installed, its necessary for slam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slam</span> <span class="o">=</span> <span class="n">Slam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slam</span><span class="o">.</span><span class="n">set_goal</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># set  far away goal for exploration, default map size [-20,20]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slam_step_size</span> <span class="o">=</span> <span class="mi">25</span>  <span class="c1"># step size in cm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>

    <span class="k">def</span> <span class="nf">restart_habitat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_robot&quot;</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span>
        <span class="n">backend_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span> <span class="o">=</span> <span class="n">Robot</span><span class="p">(</span><span class="s2">&quot;habitat&quot;</span><span class="p">,</span> <span class="n">common_config</span><span class="o">=</span><span class="n">backend_config</span><span class="p">)</span>
        <span class="c1"># todo: a bad package seems to override python logging after the line above is run.</span>
        <span class="c1"># So, all `logging.warn` and `logging.info` calls are failing to route</span>
        <span class="c1"># to STDOUT/STDERR after this.</span>
        <span class="kn">from</span> <span class="nn">habitat_utils</span> <span class="kn">import</span> <span class="n">reconfigure_scene</span>

        <span class="c1"># adds objects to the scene, doing scene-specific configurations</span>
        <span class="n">reconfigure_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend_config</span><span class="p">[</span><span class="s2">&quot;scene_path&quot;</span><span class="p">])</span>
        <span class="kn">from</span> <span class="nn">pyrobot.locobot.camera</span> <span class="kn">import</span> <span class="n">DepthImgProcessor</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_dip&quot;</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dip</span> <span class="o">=</span> <span class="n">DepthImgProcessor</span><span class="p">(</span><span class="n">cfg_filename</span><span class="o">=</span><span class="s2">&quot;realsense_habitat.yaml&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connected!!&quot;</span><span class="p">)</span>  <span class="c1"># should print on server terminal</span>
        <span class="k">return</span> <span class="s2">&quot;Connected!&quot;</span>  <span class="c1"># should print on client terminal</span>

<div class="viewcode-block" id="RemoteLocobot.get_img_resolution"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_img_resolution">[docs]</a>    <span class="k">def</span> <span class="nf">get_img_resolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return height and width&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;locobot&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">depth_cam</span><span class="o">.</span><span class="n">cfg_data</span><span class="p">[</span><span class="s2">&quot;Camera.height&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">depth_cam</span><span class="o">.</span><span class="n">cfg_data</span><span class="p">[</span><span class="s2">&quot;Camera.height&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;habitat&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="RemoteLocobot.get_pcd_data"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_pcd_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_pcd_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all the data to calculate the point cloud for a given rgb, depth frame.&quot;&quot;&quot;</span>
        <span class="n">rgb</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_rgb_depth</span><span class="p">()</span>
        <span class="n">depth</span> <span class="o">*=</span> <span class="mi">1000</span>  <span class="c1"># convert to mm</span>
        <span class="c1"># cap anything more than np.power(2,16)~ 65 meter</span>
        <span class="n">depth</span><span class="p">[</span><span class="n">depth</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;locobot&quot;</span><span class="p">:</span>
            <span class="n">trans</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_link_transform</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">cam_cf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">base_f</span>
            <span class="p">)</span>
            <span class="n">base2cam_trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">base2cam_rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">rgb</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">base2cam_rot</span><span class="p">,</span> <span class="n">base2cam_trans</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;habitat&quot;</span><span class="p">:</span>
            <span class="n">cur_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
            <span class="n">cur_sensor_state</span> <span class="o">=</span> <span class="n">cur_state</span><span class="o">.</span><span class="n">sensor_states</span><span class="p">[</span><span class="s2">&quot;rgb&quot;</span><span class="p">]</span>
            <span class="n">initial_rotation</span> <span class="o">=</span> <span class="n">cur_state</span><span class="o">.</span><span class="n">rotation</span>
            <span class="n">rot_init_rotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">_rot_matrix</span><span class="p">(</span><span class="n">initial_rotation</span><span class="p">)</span>
            <span class="n">relative_position</span> <span class="o">=</span> <span class="n">cur_sensor_state</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">cur_state</span><span class="o">.</span><span class="n">position</span>
            <span class="n">relative_position</span> <span class="o">=</span> <span class="n">rot_init_rotation</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">relative_position</span>
            <span class="n">cur_rotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">_rot_matrix</span><span class="p">(</span><span class="n">cur_sensor_state</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span>
            <span class="n">cur_rotation</span> <span class="o">=</span> <span class="n">rot_init_rotation</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">cur_rotation</span>
            <span class="k">return</span> <span class="n">rgb</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">cur_rotation</span><span class="p">,</span> <span class="o">-</span><span class="n">relative_position</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1"># Navigation wrapper</span>
<div class="viewcode-block" id="RemoteLocobot.go_home"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.go_home">[docs]</a>    <span class="nd">@Pyro4</span><span class="o">.</span><span class="n">oneway</span>
    <span class="k">def</span> <span class="nf">go_home</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Moves the robot base to origin point: x, y, yaw 0, 0, 0.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">go_to_absolute</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RemoteLocobot.go_to_absolute"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.go_to_absolute">[docs]</a>    <span class="nd">@Pyro4</span><span class="o">.</span><span class="n">oneway</span>
    <span class="k">def</span> <span class="nf">go_to_absolute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyt_position</span><span class="p">,</span> <span class="n">use_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">close_loop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Moves the robot base to given goal state in the world frame.</span>

<span class="sd">        :param xyt_position: The goal state of the form (x,y,yaw)</span>
<span class="sd">                             in the world (map) frame.</span>
<span class="sd">        :param use_map: When set to &quot;True&quot;, ensures that controller is</span>
<span class="sd">                        using only free space on the map to move the robot.</span>
<span class="sd">        :param close_loop: When set to &quot;True&quot;, ensures that controller</span>
<span class="sd">                           is operating in open loop by taking</span>
<span class="sd">                           account of odometry.</span>
<span class="sd">        :param smooth: When set to &quot;True&quot;, ensures that the motion</span>
<span class="sd">                       leading to the goal is a smooth one.</span>

<span class="sd">        :type xyt_position: list or np.ndarray</span>
<span class="sd">        :type use_map: bool</span>
<span class="sd">        :type close_loop: bool</span>
<span class="sd">        :type smooth: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">go_to_absolute</span><span class="p">(</span>
                <span class="n">xyt_position</span><span class="p">,</span> <span class="n">use_map</span><span class="o">=</span><span class="n">use_map</span><span class="p">,</span> <span class="n">close_loop</span><span class="o">=</span><span class="n">close_loop</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="n">smooth</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RemoteLocobot.go_to_relative"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.go_to_relative">[docs]</a>    <span class="nd">@Pyro4</span><span class="o">.</span><span class="n">oneway</span>
    <span class="k">def</span> <span class="nf">go_to_relative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyt_position</span><span class="p">,</span> <span class="n">use_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">close_loop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Moves the robot base to the given goal state relative to its current</span>
<span class="sd">        pose.</span>

<span class="sd">        :param xyt_position: The  relative goal state of the form (x,y,yaw)</span>
<span class="sd">        :param use_map: When set to &quot;True&quot;, ensures that controller is</span>
<span class="sd">                        using only free space on the map to move the robot.</span>
<span class="sd">        :param close_loop: When set to &quot;True&quot;, ensures that controller is</span>
<span class="sd">                           operating in open loop by taking</span>
<span class="sd">                           account of odometry.</span>
<span class="sd">        :param smooth: When set to &quot;True&quot;, ensures that the</span>
<span class="sd">                       motion leading to the goal is a smooth one.</span>

<span class="sd">        :type xyt_position: list or np.ndarray</span>
<span class="sd">        :type use_map: bool</span>
<span class="sd">        :type close_loop: bool</span>
<span class="sd">        :type smooth: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">go_to_relative</span><span class="p">(</span>
                <span class="n">xyt_position</span><span class="p">,</span> <span class="n">use_map</span><span class="o">=</span><span class="n">use_map</span><span class="p">,</span> <span class="n">close_loop</span><span class="o">=</span><span class="n">close_loop</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="n">smooth</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RemoteLocobot.stop"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.stop">[docs]</a>    <span class="nd">@Pyro4</span><span class="o">.</span><span class="n">oneway</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;stops robot base movement.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div>

<div class="viewcode-block" id="RemoteLocobot.get_base_state"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_base_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_base_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the  base pose of the robot in the (x,y, yaw) format as</span>
<span class="sd">        computed either from Wheel encoder readings or Visual-SLAM.</span>

<span class="sd">        :param state_type: Requested state type. Ex: Odom, SLAM, etc</span>

<span class="sd">        :type state_type: string</span>

<span class="sd">        :return: pose of the form [x, y, yaw]</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">state_type</span><span class="p">)</span></div>

    <span class="c1"># Manipulation wrapper</span>

<div class="viewcode-block" id="RemoteLocobot.set_joint_positions"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.set_joint_positions">[docs]</a>    <span class="nd">@Pyro4</span><span class="o">.</span><span class="n">oneway</span>
    <span class="k">def</span> <span class="nf">set_joint_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_joint</span><span class="p">,</span> <span class="n">plan</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the desired joint angles for all arm joints.</span>

<span class="sd">        :param target_joint: list of length #of joints(5 for locobot), angles in radians,</span>
<span class="sd">                             order-&gt; base_join index 0, wrist joint index -1</span>
<span class="sd">        :param plan: whether to use moveit to plan a path. Without planning,</span>
<span class="sd">                     there is no collision checking and each joint will</span>
<span class="sd">                     move to its target joint position directly.</span>

<span class="sd">        :type target_joint: list</span>
<span class="sd">        :type plan: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">target_joint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">target_joint</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">set_joint_positions</span><span class="p">(</span><span class="n">target_joint</span><span class="p">,</span> <span class="n">plan</span><span class="o">=</span><span class="n">plan</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RemoteLocobot.set_joint_velocities"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.set_joint_velocities">[docs]</a>    <span class="nd">@Pyro4</span><span class="o">.</span><span class="n">oneway</span>
    <span class="k">def</span> <span class="nf">set_joint_velocities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_vels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the desired joint velocities for all arm joints.</span>

<span class="sd">        :param target_vels: target joint velocities, list of length #of joints(5 for locobot)</span>
<span class="sd">                            velocity in  radians/sec</span>
<span class="sd">                            order-&gt; base_join index 0, wrist joint index -1</span>
<span class="sd">        :type target_vels: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">target_vels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">target_vels</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">set_joint_velocities</span><span class="p">(</span><span class="n">target_vels</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RemoteLocobot.set_ee_pose"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.set_ee_pose">[docs]</a>    <span class="nd">@Pyro4</span><span class="o">.</span><span class="n">oneway</span>
    <span class="k">def</span> <span class="nf">set_ee_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">plan</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Commands robot arm to desired end-effector pose (w.r.t.</span>
<span class="sd">        &#39;ARM_BASE_FRAME&#39;). Computes IK solution in joint space and calls</span>
<span class="sd">        set_joint_positions.</span>

<span class="sd">        :param position: position of the end effector in metric (shape: :math:`[3,]`)</span>
<span class="sd">        :param orientation: orientation of the end effector</span>
<span class="sd">                            (can be rotation matrix, euler angles (yaw,</span>
<span class="sd">                            pitch, roll), or quaternion)</span>
<span class="sd">                            (shape: :math:`[3, 3]`, :math:`[3,]`</span>
<span class="sd">                            or :math:`[4,]`)</span>
<span class="sd">                            The convention of the Euler angles here</span>
<span class="sd">                            is z-y&#39;-x&#39; (intrinsic rotations),</span>
<span class="sd">                            which is one type of Tait-Bryan angles.</span>
<span class="sd">        :param plan: use moveit the plan a path to move to the desired pose</span>

<span class="sd">        :type position: list or np.ndarray</span>
<span class="sd">        :type orientation: list or np.ndarray</span>
<span class="sd">        :type plan: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="n">orientation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">orientation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">set_ee_pose</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">plan</span><span class="o">=</span><span class="n">plan</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RemoteLocobot.move_ee_xyz"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.move_ee_xyz">[docs]</a>    <span class="nd">@Pyro4</span><span class="o">.</span><span class="n">oneway</span>
    <span class="k">def</span> <span class="nf">move_ee_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">displacement</span><span class="p">,</span> <span class="n">eef_step</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">plan</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Keep the current orientation of arm fixed, move the end effector of</span>
<span class="sd">        in {xyz} directions.</span>

<span class="sd">        :param displacement: (delta_x, delta_y, delta_z) in metric unit</span>
<span class="sd">        :param eef_step: resolution (m) of the interpolation</span>
<span class="sd">                         on the cartesian path</span>
<span class="sd">        :param plan: use moveit the plan a path to move to the</span>
<span class="sd">                     desired pose. If False,</span>
<span class="sd">                     it will do linear interpolation along the path,</span>
<span class="sd">                     and simply use IK solver to find the</span>
<span class="sd">                     sequence of desired joint positions and</span>
<span class="sd">                     then call `set_joint_positions`</span>

<span class="sd">        :type displacement: list or np.ndarray</span>
<span class="sd">        :type eef_step: float</span>
<span class="sd">        :type plan: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">move_ee_xyz</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">eef_step</span><span class="p">,</span> <span class="n">plan</span><span class="o">=</span><span class="n">plan</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="c1"># Gripper wrapper</span>
<div class="viewcode-block" id="RemoteLocobot.open_gripper"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.open_gripper">[docs]</a>    <span class="nd">@Pyro4</span><span class="o">.</span><span class="n">oneway</span>
    <span class="k">def</span> <span class="nf">open_gripper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Commands gripper to open fully.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">gripper</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RemoteLocobot.close_gripper"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.close_gripper">[docs]</a>    <span class="nd">@Pyro4</span><span class="o">.</span><span class="n">oneway</span>
    <span class="k">def</span> <span class="nf">close_gripper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Commands gripper to close fully.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">gripper</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RemoteLocobot.get_gripper_state"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_gripper_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_gripper_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the gripper state.</span>

<span class="sd">        :return: state</span>
<span class="sd">                 state = -1: unknown gripper state</span>
<span class="sd">                 state = 0: gripper is fully open</span>
<span class="sd">                 state = 1: gripper is closing</span>
<span class="sd">                 state = 2: there is an object in the gripper</span>
<span class="sd">                 state = 3: gripper is fully closed</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">gripper</span><span class="o">.</span><span class="n">get_gripper_state</span><span class="p">()</span></div>

<div class="viewcode-block" id="RemoteLocobot.get_end_eff_pose"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_end_eff_pose">[docs]</a>    <span class="k">def</span> <span class="nf">get_end_eff_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the end effector pose w.r.t &#39;ARM_BASE_FRAME&#39;</span>
<span class="sd">        :return:tuple (trans, rot_mat, quat)</span>

<span class="sd">                trans: translational vector in metric unit (shape: :math:`[3, 1]`)</span>

<span class="sd">                rot_mat: rotational matrix (shape: :math:`[3, 3]`)</span>

<span class="sd">                quat: rotational matrix in the form of quaternion (shape: :math:`[4,]`)</span>

<span class="sd">        :rtype: tuple (list, list, list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pos</span><span class="p">,</span> <span class="n">rotmat</span><span class="p">,</span> <span class="n">quat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">pose_ee</span>
        <span class="k">return</span> <span class="n">pos</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">rotmat</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">quat</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

<div class="viewcode-block" id="RemoteLocobot.get_joint_positions"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_joint_positions">[docs]</a>    <span class="k">def</span> <span class="nf">get_joint_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return arm joint angles order-&gt; base_join index 0, wrist joint index</span>
<span class="sd">        -1.</span>

<span class="sd">        :return: joint_angles in radians</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">get_joint_angles</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

<div class="viewcode-block" id="RemoteLocobot.get_joint_velocities"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_joint_velocities">[docs]</a>    <span class="k">def</span> <span class="nf">get_joint_velocities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the joint velocity order-&gt; base_join index 0, wrist joint</span>
<span class="sd">        index -1.</span>

<span class="sd">        :return: joint_angles in rad/sec</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">get_joint_velocities</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

    <span class="c1"># Common wrapper</span>
<div class="viewcode-block" id="RemoteLocobot.command_finished"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.command_finished">[docs]</a>    <span class="k">def</span> <span class="nf">command_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns whether previous executed command finished execution.</span>

<span class="sd">        return: command execution state [True for finished execution, False for still executing]</span>
<span class="sd">        rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span></div>

    <span class="c1"># Camera wrapper</span>
<div class="viewcode-block" id="RemoteLocobot.get_depth"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_depth">[docs]</a>    <span class="k">def</span> <span class="nf">get_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the depth image perceived by the camera.</span>

<span class="sd">        :return: depth image in meters, dtype-&gt; float32</span>
<span class="sd">        :rtype: np.ndarray or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_depth</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">depth</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="RemoteLocobot.get_depth_bytes"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_depth_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">get_depth_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the depth image perceived by the camera.</span>

<span class="sd">        :return: depth image in meters, dtype-&gt; bytes</span>
<span class="sd">        :rtype: np.ndarray or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_depth</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">depth</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="RemoteLocobot.get_intrinsics"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_intrinsics">[docs]</a>    <span class="k">def</span> <span class="nf">get_intrinsics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the intrinsic matrix of the camera.</span>

<span class="sd">        :return: the intrinsic matrix (shape: :math:`[3, 3]`)</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">intrinsics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_intrinsics</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">intrinsics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">intrinsics</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="RemoteLocobot.get_rgb"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_rgb">[docs]</a>    <span class="k">def</span> <span class="nf">get_rgb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the RGB image perceived by the camera.</span>

<span class="sd">        :return: image in the RGB, [h,w,c] format, dtype-&gt;uint8</span>
<span class="sd">        :rtype: np.ndarray or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_rgb</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rgb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rgb</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="RemoteLocobot.get_rgb_bytes"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_rgb_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">get_rgb_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the RGB image perceived by the camera.</span>

<span class="sd">        :return: image in the RGB, [h,w,c] format, dtype-&gt;bytes</span>
<span class="sd">        :rtype: np.ndarray or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_rgb</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rgb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rgb</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="RemoteLocobot.transform_pose"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.transform_pose">[docs]</a>    <span class="k">def</span> <span class="nf">transform_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">XYZ</span><span class="p">,</span> <span class="n">current_pose</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms the point cloud into geocentric frame to account for</span>
<span class="sd">        camera position</span>

<span class="sd">        Args:</span>
<span class="sd">            XYZ                     : ...x3</span>
<span class="sd">            current_pose            : camera position (x, y, theta (radians))</span>
<span class="sd">        Returns:</span>
<span class="sd">            XYZ : ...x3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_euler</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="n">current_pose</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
        <span class="n">XYZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">XYZ</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">XYZ</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">XYZ</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">current_pose</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">XYZ</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">XYZ</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">current_pose</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">XYZ</span></div>

<div class="viewcode-block" id="RemoteLocobot.get_current_pcd"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_current_pcd">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_pcd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_cam</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">in_global</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the point cloud at current time step.</span>

<span class="sd">        :param in_cam: return points in camera frame,</span>
<span class="sd">                       otherwise, return points in base frame</span>

<span class="sd">        :type in_cam: bool</span>

<span class="sd">        :returns: tuple (pts, colors)</span>

<span class="sd">                  pts: point coordinates (shape: :math:`[N, 3]`) in metric unit</span>

<span class="sd">                  colors: rgb values (shape: :math:`[N, 3]`)</span>
<span class="sd">        :rtype: tuple(list, list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pts</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_current_pcd</span><span class="p">(</span><span class="n">in_cam</span><span class="o">=</span><span class="n">in_cam</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">in_global</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_pose</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="s2">&quot;odom&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pts</span><span class="p">,</span> <span class="n">colors</span></div>

<div class="viewcode-block" id="RemoteLocobot.pix_to_3dpt"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.pix_to_3dpt">[docs]</a>    <span class="k">def</span> <span class="nf">pix_to_3dpt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">in_cam</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the 3D points of the pixels in RGB images in metric unit.</span>

<span class="sd">        :param rs: rows of interest in the RGB image.</span>
<span class="sd">                   It can be a list or 1D numpy array</span>
<span class="sd">                   which contains the row indices.</span>
<span class="sd">        :param cs: columns of interest in the RGB image.</span>
<span class="sd">                   It can be a list or 1D numpy array</span>
<span class="sd">                   which contains the column indices.</span>
<span class="sd">        :param in_cam: return points in camera frame,</span>
<span class="sd">                       otherwise, return points in base frame</span>

<span class="sd">        :type rs: list or np.ndarray</span>
<span class="sd">        :type cs: list or np.ndarray</span>
<span class="sd">        :type in_cam: bool</span>

<span class="sd">        :returns: tuple (pts, colors)</span>

<span class="sd">                  pts: point coordinates in metric unit</span>
<span class="sd">                  (shape: :math:`[N, 3]`)</span>

<span class="sd">                  colors: rgb values</span>
<span class="sd">                  (shape: :math:`[N, 3]`)</span>

<span class="sd">        :rtype: tuple(list, list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pts</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pix_to_3dpt</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">in_cam</span><span class="o">=</span><span class="n">in_cam</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pts</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">colors</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

<div class="viewcode-block" id="RemoteLocobot.dip_pix_to_3dpt"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.dip_pix_to_3dpt">[docs]</a>    <span class="k">def</span> <span class="nf">dip_pix_to_3dpt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the point cloud at current time step in robot base frame.</span>

<span class="sd">        :returns: point coordinates (shape: :math:`[N, 3]`) in metric unit</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;dip_pix_to_3dpt&quot;</span><span class="p">)</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_depth</span><span class="p">()</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">w</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">h</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix_to_3dpt</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;exiting pix_to_3dpt&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pts</span></div>

<div class="viewcode-block" id="RemoteLocobot.get_transform"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_transform">[docs]</a>    <span class="k">def</span> <span class="nf">get_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_frame</span><span class="p">,</span> <span class="n">dst_frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the transform from the src_frame to dest_frame.</span>

<span class="sd">        :param src_frame: source frame</span>
<span class="sd">        :param dest_frame: destination frame</span>

<span class="sd">        :type src_frame: str</span>
<span class="sd">        :type dest_frame: str</span>

<span class="sd">        :return:tuple (trans, rot_mat, quat )</span>
<span class="sd">                trans: translational vector (shape: :math:`[3, 1]`)</span>
<span class="sd">                rot_mat: rotational matrix (shape: :math:`[3, 3]`)</span>
<span class="sd">                quat: rotational matrix in the form of quaternion (shape: :math:`[4,]`)</span>

<span class="sd">        :rtype: tuple(np.ndarray, np.ndarray, np.ndarray)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="n">src_frame</span><span class="p">,</span> <span class="n">dst_frame</span><span class="p">)</span></div>

    <span class="c1"># Camera pan wrapper</span>
<div class="viewcode-block" id="RemoteLocobot.get_pan"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_pan">[docs]</a>    <span class="k">def</span> <span class="nf">get_pan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the current pan joint angle of the robot camera.</span>

<span class="sd">        :return:Pan joint angle in radian</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_pan</span><span class="p">()</span></div>

<div class="viewcode-block" id="RemoteLocobot.get_camera_state"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_camera_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_camera_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the current pan and tilt joint angles of the robot camera in</span>
<span class="sd">        radian.</span>

<span class="sd">        :return: A list the form [pan angle, tilt angle]</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span></div>

<div class="viewcode-block" id="RemoteLocobot.get_tilt"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.get_tilt">[docs]</a>    <span class="k">def</span> <span class="nf">get_tilt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the current tilt joint angle of the robot camera in radian.</span>

<span class="sd">        :return:tilt joint angle</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_tilt</span><span class="p">()</span></div>

<div class="viewcode-block" id="RemoteLocobot.reset"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.reset">[docs]</a>    <span class="nd">@Pyro4</span><span class="o">.</span><span class="n">oneway</span>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function resets the pan and tilt joints of robot camera by</span>
<span class="sd">        actuating them to their home configuration [0.0, 0.0].&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RemoteLocobot.set_pan"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.set_pan">[docs]</a>    <span class="nd">@Pyro4</span><span class="o">.</span><span class="n">oneway</span>
    <span class="k">def</span> <span class="nf">set_pan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pan</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the pan joint angle of robot camera to the specified value.</span>

<span class="sd">        :param pan: value to be set for pan joint in radian</span>
<span class="sd">        :param wait: wait until the pan angle is set to</span>
<span class="sd">                     the target angle.</span>

<span class="sd">        :type pan: float</span>
<span class="sd">        :type wait: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">set_pan</span><span class="p">(</span><span class="n">pan</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RemoteLocobot.set_pan_tilt"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.set_pan_tilt">[docs]</a>    <span class="nd">@Pyro4</span><span class="o">.</span><span class="n">oneway</span>
    <span class="k">def</span> <span class="nf">set_pan_tilt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pan</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets both the pan and tilt joint angles of the robot camera  to the</span>
<span class="sd">        specified values.</span>

<span class="sd">        :param pan: value to be set for pan joint in radian</span>
<span class="sd">        :param tilt: value to be set for the tilt joint in radian</span>
<span class="sd">        :param wait: wait until the pan and tilt angles are set to</span>
<span class="sd">                     the target angles.</span>

<span class="sd">        :type pan: float</span>
<span class="sd">        :type tilt: float</span>
<span class="sd">        :type wait: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">set_pan_tilt</span><span class="p">(</span><span class="n">pan</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RemoteLocobot.set_tilt"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.set_tilt">[docs]</a>    <span class="nd">@Pyro4</span><span class="o">.</span><span class="n">oneway</span>
    <span class="k">def</span> <span class="nf">set_tilt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the tilt joint angle of robot camera to the specified value.</span>

<span class="sd">        :param tilt: value to be set for the tilt joint in radian</span>
<span class="sd">        :param wait: wait until the tilt angle is set to</span>
<span class="sd">                     the target angle.</span>

<span class="sd">        :type tilt: float</span>
<span class="sd">        :type wait: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_robot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">set_tilt</span><span class="p">(</span><span class="n">tilt</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="c1"># grasping wrapper</span>
<div class="viewcode-block" id="RemoteLocobot.grasp"><a class="viewcode-back" href="../../../droidlet_agents.html#locobot.robot.RemoteLocobot.grasp">[docs]</a>    <span class="k">def</span> <span class="nf">grasp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">480</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">540</span><span class="p">)]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param dims: List of tuples of min and max indices of the image axis to be considered for grasp search</span>
<span class="sd">        :type dims: list</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># TODO: in reset, pan of camera is set to point to ground, may not need that part</span>
            <span class="c1"># success = self._grasper.reset()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># grasp_pose = self._grasper.compute_grasp(dims=dims)</span>
            <span class="c1"># self._grasper.grasp(grasp_pose)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">True</span></div>

    <span class="c1"># slam wrapper</span>
    <span class="k">def</span> <span class="nf">explore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slam</span><span class="o">.</span><span class="n">take_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_slam_step_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">True</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">argparse</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Pass in server device IP&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--ip&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Server device (robot) IP. Default is 192.168.0.0&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;192.168.0.0&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--backend&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;PyRobot backend to use (locobot | habitat). Default is locobot&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;locobot&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--backend_config&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Optional config argument to be passed to the backend.&quot;</span>
        <span class="s2">&quot;Currently mainly used to pass Habitat environment path&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;{&quot;scene_path&quot;: &quot;/Replica-Dataset/apartment_0/habitat/mesh_semantic.ply&quot;, &quot;physics_config&quot;: &quot;DEFAULT&quot;}&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;habitat&quot;</span><span class="p">:</span>
        <span class="c1"># GLContexts in general are thread local</span>
        <span class="c1"># The PyRobot &lt;-&gt; Habitat integration is not thread-aware / thread-configurable,</span>
        <span class="c1"># so our only option is to disable Pyro4&#39;s threading, and instead switch to</span>
        <span class="c1"># multiplexing (which isn&#39;t too bad)</span>
        <span class="n">Pyro4</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">SERVERTYPE</span> <span class="o">=</span> <span class="s2">&quot;multiplex&quot;</span>

    <span class="k">with</span> <span class="n">Pyro4</span><span class="o">.</span><span class="n">Daemon</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">ip</span><span class="p">)</span> <span class="k">as</span> <span class="n">daemon</span><span class="p">:</span>
        <span class="n">robot</span> <span class="o">=</span> <span class="n">RemoteLocobot</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span> <span class="n">backend_config</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">backend_config</span><span class="p">)</span>
        <span class="n">robot_uri</span> <span class="o">=</span> <span class="n">daemon</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">robot</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">Pyro4</span><span class="o">.</span><span class="n">locateNS</span><span class="p">()</span> <span class="k">as</span> <span class="n">ns</span><span class="p">:</span>
            <span class="n">ns</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;remotelocobot&quot;</span><span class="p">,</span> <span class="n">robot_uri</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Server is started...&quot;</span><span class="p">)</span>
        <span class="n">daemon</span><span class="o">.</span><span class="n">requestLoop</span><span class="p">()</span>


<span class="c1"># Below is client code to run in a separate Python shell...</span>
<span class="c1"># import Pyro4</span>
<span class="c1"># robot = Pyro4.Proxy(&quot;PYRONAME:remotelocobot&quot;)</span>
<span class="c1"># robot.go_home()</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Facebook AI.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>